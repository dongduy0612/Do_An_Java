--------------------------------------------------------------------TẠO DATABASE---------------------------------------------------------------------
CREATE DATABASE QUAN_LY_QUAN_CAFE
GO
USE QUAN_LY_QUAN_CAFE
GO
---------------------------------------------------------------TẠO BẢNG,KHOÁ CHÍNH,KHOÁ NGOẠI--------------------------------------------------------
------ TẠO BẢNG TAIKHOAN
CREATE TABLE QUANTRI
(
	TENTK VARCHAR(20) NOT NULL PRIMARY KEY,
	MATKHAU VARCHAR(20) not null,
)

------ TẠO BẢNG NHANVIEN
CREATE TABLE NHANVIEN
(
	MANV CHAR(10) NOT NULL PRIMARY KEY,
	MATKHAU VARCHAR(30) NOT NULL,
    TENNV NVARCHAR(30) NOT NULL,
	GIOITINH NCHAR(5),
	DIACHI NVARCHAR(50),
	NAMSINH DATE,
	NGAYVL DATE NOT NULL,
	SODT CHAR(11),
	LUONG FLOAT
)
------ TẠO BẢNG LOAIKH
CREATE TABLE LOAIKH
(
	MALOAIKH CHAR(10) NOT NULL PRIMARY KEY,
	TENLOAIKH NVARCHAR(50) NOT NULL,
	GIAMGIA FLOAT
)
------ TẠO BẢNG KHACHHANG
CREATE TABLE KHACHHANG
(
	MAKH CHAR(10) NOT NULL PRIMARY KEY,
	TENKH NVARCHAR(30) NOT NULL,
	GIOITINH NCHAR(5),
	DIACHI NVARCHAR(50),
	SDT CHAR(11),
	MALOAIKH CHAR(10),
	CONSTRAINT FK_KHACHHANG_LOAIKH FOREIGN KEY(MALOAIKH) REFERENCES LOAIKH(MALOAIKH)
)

------ TẠO BẢNG LOAINUOC
CREATE TABLE LOAINUOC
(
	MALOAINUOC CHAR(10) NOT NULL PRIMARY KEY,
	TENLOAINUOC NVARCHAR(30)
)
------ TẠO BẢNG MONAN
CREATE TABLE NUOCUONG
(
	MANUOCUONG CHAR(10) NOT NULL PRIMARY KEY,
	TENNUOCUONG NVARCHAR(30),
	MALOAINUOC CHAR(10),
	DONGIA FLOAT,
	CONSTRAINT FK_MONAN_LOAINUOC FOREIGN KEY(MALOAINUOC) REFERENCES LOAINUOC(MALOAINUOC)
)
------ TẠO BẢNG BAN
CREATE TABLE BAN
(
	MABAN CHAR(10) NOT NULL PRIMARY KEY,
	TENBAN NVARCHAR(20),
	TINHTRANG NVARCHAR(30)
)

------ TẠO BẢNG NHAPKHO
CREATE TABLE NHAPKHO
(
	MANHAP CHAR(10) NOT NULL PRIMARY KEY,
	NGAYNHAP DATE,
	MANV CHAR(10),
	THANHTIEN FLOAT,
	CONSTRAINT FK_NHAPKHO_NHANVIEN FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
)
------ TẠO BẢNG CHITIETNK
CREATE TABLE CHITIETNK
(
	MANHAP CHAR(10) NOT NULL,
	MANUOCUONG CHAR(10) NOT NULL,
	SOLUONG INT,
	GIANHAP FLOAT,
	CONSTRAINT PK_CHITIETNK PRIMARY KEY(MANHAP,MANUOCUONG),
	CONSTRAINT FK_CHITIETNK_NHAPKHO FOREIGN KEY(MANHAP) REFERENCES NHAPKHO(MANHAP),
	CONSTRAINT FK_CHITIETNK_NUOCUONG FOREIGN KEY(MANUOCUONG) REFERENCES NUOCUONG(MANUOCUONG) 
)
------ TẠO BẢNG HOADON
CREATE TABLE HOADON
(
	MAHD CHAR(10) NOT NULL PRIMARY KEY,
	NGAYRAHD DATE,
	THANHTOAN FLOAT,
	MANV CHAR(10),
	CONSTRAINT FK_HOADON_NHANVIEN FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
)
------ TẠO BẢNG CHITIETHD
CREATE TABLE CHITIETHD
(
	MAHD CHAR(10) NOT NULL,
	MANUOCUONG CHAR(10) NOT NULL,
	SOLUONG INT,
	THANHTIEN FLOAT,
	CONSTRAINT PK_CHITIETHD PRIMARY KEY(MAHD,MANUOCUONG),
	CONSTRAINT FK_CHITIETHD_HOADON FOREIGN KEY(MAHD) REFERENCES HOADON(MAHD),
	CONSTRAINT FK_CHITIETHD_NUOCUONG FOREIGN KEY(MANUOCUONG) REFERENCES NUOCUONG(MANUOCUONG)
)
select *from HOADON
select *from CHITIETHD

-------------------------------------------------------------Tạo ràng buộc toàn vẹn------------------------------------------------------------------
-----------------Bảng NHANVIEN
----LƯƠNG PHẢI LỚN HƠN 0
ALTER TABLE NHANVIEN ADD CONSTRAINT CHK_LUONG CHECK(LUONG>0)
----GIỚI TÍNH THUỘC NAM HOẶC NỮ
ALTER TABLE NHANVIEN ADD CONSTRAINT CHK_GIOITINH_NV CHECK(GIOITINH IN('NAM',N'NỮ'))
-----------------Bảng LOAIKH
----TÊN LOẠI KHÁCH HÀNG LÀ DUY NHẤT
ALTER TABLE LOAIKH ADD CONSTRAINT UNI_TENLOAIKH UNIQUE(TENLOAIKH)
----TÊN LOẠI KHÁCH HÀNG NẰM TRONG CÁC GIÁ TRỊ:KHÁCH HÀNG THƯỜNG,KHÁCH HÀNG TIỀM NĂNG,KHÁCH HÀNG THÂN THIẾT,KHÁCH HÀNG VIP
ALTER TABLE LOAIKH ADD CONSTRAINT CHK_TENLOAIKH CHECK(TENLOAIKH IN (N'KHÁCH HÀNG THƯỜNG',N'KHÁCH HÀNG TIỀM NĂNG',N'KHÁCH HÀNG THÂN THIẾT',N'KHÁCH HÀNG VIP'))
----TÊN LOẠI KHÁCH HÀNG MẶC ĐỊNH LÀ KHÁCH HÀNG THƯỜNG
ALTER TABLE LOAIKH ADD CONSTRAINT DF_TENLOAIKH DEFAULT N'KHÁCH HÀNG THƯỜNG' FOR TENLOAIKH
----GIẢM GIÁ PHẢI LỚN HƠN HOẶC BẰNG 0
ALTER TABLE LOAIKH ADD CONSTRAINT CHK_GIAMGIA_LOAIKH CHECK(GIAMGIA>=0)
-----------------Bảng KHACHHANG
----GIỚI TÍNH THUỘC NAM HOẶC NỮ
ALTER TABLE KHACHHANG ADD CONSTRAINT CHK_GIOITINH_KH CHECK(GIOITINH IN('NAM',N'NỮ'))
-----------------Bảng LOAINUOCUONG
------TÊN LOẠI MÓN PHẢI DUY NHẤT
ALTER TABLE LOAINUOC ADD CONSTRAINT UNI_TENLOAINUOC UNIQUE(TENLOAINUOC)
-----------------Bảng NUOCUONG
------TÊN MÓN PHẢI DUY NHẤT
ALTER TABLE NUOCUONG ADD CONSTRAINT UNI_TENNUOCUONG UNIQUE(TENNUOCUONG)
------ĐƠN GIÁ PHẢI LỚN HƠN 0
ALTER TABLE NUOCUONG ADD CONSTRAINT CHK_DONGIA_NUOCUONG CHECK(DONGIA>0)
-----------------Bảng BAN
----TÊN BÀN LÀ DUY NHẤT
ALTER TABLE BAN ADD CONSTRAINT UNI_TENBAN UNIQUE(TENBAN)
----TÌNH TRẠNG MẶC ĐỊNH LÀ 0
ALTER TABLE BAN ADD CONSTRAINT DF_TINHTRANG DEFAULT 0 FOR TINHTRANG
-----------------Bảng HOADON
------THANH TOÁN PHẢI LỚN HƠN 0
ALTER TABLE HOADON ADD CONSTRAINT CHK_THANHTOAN CHECK(THANHTOAN>0)
-----------------Bảng CHITIETHD
------SỐ LƯỢNG PHẢI LỚN HƠN 0
ALTER TABLE CHITIETHD ADD CONSTRAINT CHK_SOLUONG_CTHD CHECK(SOLUONG>0)
------THÀNH TIỀN PHẢI LỚN HƠN 0
ALTER TABLE CHITIETHD ADD CONSTRAINT CHK_THANHTIEN_CTHD CHECK(THANHTIEN>0)
------------------BẢNG CHITIETNK
------SỐ LƯỢNG PHẢI LỚN HƠN 0
ALTER TABLE CHITIETNK ADD CONSTRAINT CHK_SOLUONG_CTNK CHECK(SOLUONG>0)
------GIÁ NHẬP PHẢI LỚN HƠN 0
ALTER TABLE CHITIETNK ADD CONSTRAINT CHK_GIANHAP_CTNK CHECK(GIANHAP>0)
------------------------------------------------------------INSERT DỮ LIỆU---------------------------------------------------------------------------
----BẢNG QUẢN TRỊ
insert into QUANTRI values
('admin','admin')


----BẢNG NHÂN VIÊN
SET DATEFORMAT DMY
INSERT INTO NHANVIEN VALUES
('NV01','12345',N'NGUYỄN NGỌC TÚ ANH',N'NỮ',N'TP.HCM','23/04/1999','14/03/2019','0234327865',2000000),
('NV02','12345',N'DƯƠNG ĐÔNG DUY',N'NAM',N'TIỀN GIANG','06/12/2001','14/06/2020','0382762835',2300000),
('NV03','12345',N'ĐIÊU NGỌC TRINH',N'NỮ',N'TP.HCM','17/10/2001','20/03/2020','05097362749',2300000),
('NV04','12345',N'LÊ XUÂN BẮC',N'NAM',N'ĐẮK LẮK','05/06/2001','15/03/2019','0234327865',2000000),
('NV05','12345',N'NGUYỄN THỊ THẢO VY',N'NỮ',N'TIỀN GIANG','03/02/2001','03/03/2019','0353676482',2000000),
('NV06','12345',N'NGÔ THANH HUYỀN',N'NỮ',N'QUẢNG BÌNH','10/03/2001','03/12/2018','0583527543',2000000),
('NV07','12345',N'VÕ THỊ THU HÀ',N'NỮ',N'BÌNH ĐỊNH','10/03/2001','30/3/2019','0738456281',5000000),
('NV08','12345',N'TRẦN TUẤN ANH',N'NAM',N'LONH AN','07/12/2000','08/03/2020','0487362873',2000000),
('NV09','12345',N'LƯU THANH BÌNH',N'NAM',N'PHÚ YÊN','28/02/1999','23/09/2020','0387529267',2000000),
('NV10','12345',N'VŨ THỊ THANH DANH',N'NỮ',N'TP.HCM','04/05/1999','23/03/2020','0473526483',2000000)

---BẢNG LOAIKH
INSERT INTO LOAIKH VALUES
('MLK01',N'KHÁCH HÀNG VIP',10),
('MLK02',N'KHÁCH HÀNG TIỀM NĂNG',8),
('MLK03',N'KHÁCH HÀNG THÂN THIẾT',5),
('MLK04',N'KHÁCH HÀNG THƯỜNG',0)

---BẢNG KHACHHANG
select *from khachHang,loaiKh where khachhang.maloaikh=khachhang.maloaikh and makh='KH01'
INSERT INTO KHACHHANG VALUES
('KH01',N'NGUYỄN HẢI ĐĂNG',N'NAM',N'TP.HCM','0364767243','MLK01'),
('KH02',N'HOÀNG TIẾN ĐẠT',N'NAM',N'CẦN THƠ','0463745625','MLK02'),
('KH03',N'TRỊNH DUY ĐÔNG',N'NAM',N'AN GIANG','0975645370','MLK03'),
('KH04',N'VÕ THUỲ DƯƠNG',N'NỮ',N'LONG AN','0976352638','MLK04'),
('KH05',N'NGUYỄN THỊ HẠNH DUYÊN',N'NỮ',N'TP.HCM','0945324538','MLK02'),
('KH06',N'NGUYỄN NHẬT HÀO',N'NAM',N'TP.HCM','0463725379','MLK03'),
('KH07',N'TRƯƠNG THỊ HOA',N'NỮ',N'TP.HCM','0403647365','MLK04'),
('KH08',N'TRẦN THỊ THUÝ HOÀ',N'NỮ',N'TP.HCM','0402045342','MLK01'),
('KH09',N'TRẦN THỊ KIỀU OANH',N'NỮ',N'TP.HCM','0286534271','MLK03'),
('KH10',N'TRẦN THỊ THU HỒNG',N'NỮ',N'TP.HCM','04837523527','MLK04'),
('KH11',N'NGUYỄN THỊ HỒNG',N'NỮ',N'TP.HCM','0354828423','MLK02'),
('KH12',N'ĐỖ THỊ NGỌC HƯƠNG ',N'NỮ',N'TP.HCM','0835427287','MLK03'),
('KH13',N'LÊ THANH TUẤN KIỆT',N'NAM',N'TP.HCM','09876543212','MLK01'),
('KH14',N'MAI ĐỨC KIỀU',N'NAM',N'TRẦN THỊ KIỀU OANHTP.HCM','0925362438','MLK04'),
('KH15',N'HUỲNH TRỌNG HIỂN',N'NAM',N'TIỀN GIANG','0987678678','MLK02'),
('KH16',N'NGUYỄN MINH NHỰT',N'NAM',N'VĨNH LONG','0876563211','MLK01'),
('KH17',N'NGUYỄN THẢO HƯƠNG QUỲNH',N'NỮ',N'KIÊN GIANG','0376880903','MLK03'),
('KH18',N'NGUYỄN TRẦN HOÀ HỢP',N'NỮ',N'BẾN TRE','0988322241','MLK02'),
('KH19',N'LÊ HIẾU NGHĨA',N'NAM',N'BẾN TRE','0878493212','MLK04'),
('KH20',N'NGUYỄN MINH ĐỨC',N'NAM',N'CÀ MAU','0987771232','MLK03')
-----BẢNG LOAINUOC
INSERT INTO LOAINUOC VALUES
('LN01',N'COFFEE'),
('LN02',N'MILK TEA'),
('LN03',N'YAOURT'),
('LN04',N'SINH TỐ'),
('LN05',N'MATCHA'),
('LN06',N'ICE BLENDED'),
('LN07',N'SODA'),
('LN08',N'FLAVORRED'),
('LN09',N'NƯỚC ÉP'),
('LN10',N'FRESH FRUIT TEA')

------ INSERT BẢNG NUOCUONG
	select *from hoadon

INSERT INTO NUOCUONG VALUES
('N01',N'COFFEE ĐEN','LN01',14000),
('N02',N'SỮA TƯƠI COFFEE','LN01',18000),
('N03',N'TRÀ SỮA BÁ TƯỚC','LN02',220000),
('N04',N' TRÀ SỮA SOCOLA','LN02',20000),
('N05',N'YAOURT ĐÁ','LN03 ',250000),
('N06',N'YAOURT DÂU','LN03 ',25000),
('N07',N'YAOURT TRÁI CÂY','LN03 ',25000),
('N08',N'SINH TỐ DƯA HẤU','LN04',28000),
('N09',N'SINH TỐ DỪA','LN04',28000),
('N10',N'SINH TỐ CAM','LN04',28000),
('N11',N'MATCHA MẬT ONG','LN05',30000),
('N12',N'MATCHA MANGO','LN05',30000),
('N13',N'MATCHA OREO','LN05',30000),
('N14',N'MATCHA ĐẬU ĐỎ','LN05',30000),
('N15',N'ĐÁ XAY VỊ DÂU','LN06',30000),
('N16',N'ĐÁ XAY VỊ PHÚC BỒN TỬ','LN06',30000),
('N17',N'SODA BẠC HÀ','LN07',20000),
('N18',N'SODA CHANH','LN07',20000),
('N19',N'HỒNG TRÀ','LN08',15000),
('N20',N'TRÀ HOA ĐẬU BIẾC','LN08',22000),
('N21',N'TRÀ BÁ TƯỚC','LN08',25000),
('N22',N'TRÀ OLONG','LN08',25000),
('N23',N'NƯỚC ÉP CAM','LN09',26000),
('N24',N'NƯỚC ÉP TÁO','LN09',23000),
('N25',N'NƯỚC ÉP DƯA HẤU','LN09',19000),
('N26',N'NƯỚC ÉP DÂU','LN09',20000),
('N27',N'NƯỚC ÉP THƠM','LN09',20000),
('N28',N'TRÀ DÂU HOA HỒNG','LN10',30000),
('N29',N'TRÀ ĐÀO CAM SẢ','LN10',30000),
('N30',N'TRÀ DÂU CAM VÀNG','LN10',30000)

